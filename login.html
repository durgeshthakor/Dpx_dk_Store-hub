<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - DPX Secure</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background-color: #000; color: white; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
        .orb { position: absolute; border-radius: 50%; filter: blur(80px); opacity: 0.6; animation: float 10s infinite ease-in-out; }
        .orb-1 { width: 300px; height: 300px; background: #6b21a8; top: -50px; left: -50px; }
        .orb-2 { width: 400px; height: 400px; background: #1e3a8a; bottom: -100px; right: -100px; animation-delay: 2s; }
        .glass-panel { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 0 40px rgba(139, 92, 246, 0.1); }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
    </style>
</head>
<body class="flex items-center justify-center h-screen relative">

    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>

    <div class="glass-panel p-10 rounded-3xl w-full max-w-sm text-center z-10 relative transform transition hover:scale-105 duration-500">
        <div class="w-20 h-20 bg-gradient-to-tr from-purple-600 to-blue-600 rounded-full mx-auto flex items-center justify-center mb-6 shadow-lg shadow-purple-500/50">
            <i class="fas fa-shield-alt text-3xl"></i>
        </div>
        
        <h1 class="text-3xl font-bold mb-2">Welcome Back</h1>
        <p class="text-gray-400 text-sm mb-8">Secure Access to DPX Store</p>

        <button id="login-btn" class="w-full bg-white text-black py-3.5 rounded-xl font-bold flex items-center justify-center gap-3 hover:bg-gray-200 transition shadow-[0_0_20px_rgba(255,255,255,0.3)]">
            <img src="https://www.svgrepo.com/show/475656/google-color.svg" class="w-5 h-5">
            Continue with Google
        </button>

        <p class="mt-8 text-xs text-gray-500">By logging in, you agree to our Terms of Service.</p>
    </div>

    <script type="module">
        import { auth, provider, signInWithPopup, onAuthStateChanged, db, doc, getDoc, setDoc } from './config.js';

        // Auto Redirect if already logged in
        onAuthStateChanged(auth, (user) => {
            if (user) window.location.href = "index.html";
        });

        document.getElementById('login-btn').addEventListener('click', async () => {
            try {
                const result = await signInWithPopup(auth, provider);
                const user = result.user;

                // Check Ban Status immediately
                const userRef = doc(db, "users", user.email);
                const userSnap = await getDoc(userRef);

                if (userSnap.exists() && userSnap.data().isBanned) {
                    await auth.signOut();
                    alert("ðŸš« ACCESS DENIED: You are banned by Admin.");
                    return;
                }

                // Create user entry if new
                if (!userSnap.exists()) {
                    await setDoc(userRef, {
                        email: user.email,
                        name: user.displayName,
                        photo: user.photoURL,
                        isBanned: false,
                        isPremium: false,
                        joinedAt: new Date()
                    });
                }
                
                window.location.href = "index.html";
            } catch (error) {
                console.error(error);
                alert("Login Failed");
            }
        });
    </script>
</body>
</html>
